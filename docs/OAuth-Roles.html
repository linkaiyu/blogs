
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>OAuth 2.0 Flows × Role Claims in Microsoft Entra ID — One‑Page Cheat Sheet (with Section References)</title>
<style>
    :root{--bg:#0f172a;--card:#111827;--ink:#e5e7eb;--ink2:#cbd5e1;--accent:#60a5fa;--good:#34d399;--warn:#f59e0b;--bad:#f87171;--code:#0b1020;}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
    .page{max-width:1100px;margin:28px auto;padding:0 16px}
    header{margin-bottom:16px}
    h1{font-size:1.9rem;line-height:1.2;margin:0 0 8px}
    h2{font-size:1.25rem;margin:24px 0 8px;color:var(--ink)}
    h3{font-size:1.1rem;margin:20px 0 6px;color:var(--ink)}
    p,li{color:var(--ink2)}
    .card{background:var(--card);border:1px solid #1f2937;border-radius:12px;padding:16px;margin:16px 0}
    .grid{display:grid;gap:12px}
    @media (min-width: 900px){.grid-2{grid-template-columns:1fr 1fr}}
    code,kbd,pre{font-family:ui-monospace,SFMono-Regular,Consolas,Menlo,monospace}
    pre{background:var(--code);border-radius:10px;padding:12px;overflow:auto;border:1px solid #1e293b}
    code.inline{background:#0a0f1a;border:1px solid #132238;color:#e2e8f0;border-radius:6px;padding:0 4px}
    table{width:100%;border-collapse:collapse;background:var(--card);border:1px solid #1f2937;border-radius:10px;overflow:hidden}
    th,td{padding:10px;border-bottom:1px solid #1f2937;text-align:left;vertical-align:top;color:var(--ink2)}
    th{background:#0e1a2b;color:#cfe1ff}
    .pill{display:inline-block;padding:.15rem .45rem;border-radius:999px;border:1px solid #334155;background:#0b1220;color:#cfe1ff}
    .pill.good{border-color:#065f46;color:#a7f3d0}
    .pill.warn{border-color:#78350f;color:#fde68a}
    .pill.bad{border-color:#7f1d1d;color:#fecaca}
    a{color:#93c5fd;text-decoration:none}
    a:hover{text-decoration:underline}
    .muted{color:#94a3b8}
    .sources{margin-top:10px;border-top:1px dashed #243447;padding-top:10px}
    .sources h4{margin:0 0 6px;font-weight:600;color:#a5b4fc}
    .footnotes{font-size:.95rem}
  </style>
</head>
<body>
<div class="page">
<header>
<h1>OAuth 2.0 Flows × Role Claims in Microsoft Entra ID — One‑Page Cheat Sheet</h1>
<p class="muted">Each section includes <em>document references</em> to the Microsoft Learn/Q&amp;A source(s) it draws from.</p>
</header>
<section class="card" id="quick-facts">
<h2>Quick facts</h2>
<ul>
<li><strong>Delegated (user) tokens</strong> carry <code class="inline">scp</code> (scopes); <code class="inline">roles</code> appear only if the <em>API app</em> defines user roles and the user is assigned to them.</li>
<li><strong>Application (app-only) tokens</strong> from <em>Client Credentials</em> never have <code class="inline">scp</code>; they carry <code class="inline">roles</code> when the API app exposes <em>application</em> roles and the calling app is assigned.</li>
<li>Define app roles on the <strong>API app registration</strong> (not the client app) and assign users/groups or applications via <strong>Enterprise applications</strong>.</li>
<li><strong>ID tokens</strong> are for the client; <strong>access tokens</strong> are for the API. Enforce <code class="inline">scp</code> (delegated) or <code class="inline">roles</code> (app-only) in the API.</li>
</ul>
<div class="sources">
<h4>Sources for this section</h4>
<ul>
<li><a href="https://learn.microsoft.com/en-us/entra/identity-platform/scenario-protected-web-api-verification-scope-app-roles" rel="noopener" target="_blank">Protected web API: Verify scopes &amp; app roles</a></li>
<li><a href="https://learn.microsoft.com/en-us/answers/questions/2237097/azure-ad-access-token-is-missing-scope-or-roles-cl" rel="noopener" target="_blank">Q&amp;A: Client credentials tokens missing scp (by design)</a></li>
<li><a href="https://learn.microsoft.com/en-us/entra/identity-platform/howto-add-app-roles-in-apps" rel="noopener" target="_blank">Add app roles &amp; receive them in the token</a></li>
<li><a href="https://learn.microsoft.com/en-us/entra/identity-platform/id-token-claims-reference" rel="noopener" target="_blank">ID token claims reference</a></li>
</ul>
</div>
</section>

<section id="rbac-summary">
<h2>Summary: When Manifest Editing Is Needed for RBAC Configuration</h2>
<table border="1" cellpadding="6" cellspacing="0">
<thead>
<tr>
<th>RBAC Element</th>
<th>Manifest Editing Needed?</th>
<th>Example Use Cases</th>
<th>Configuration Method</th>
</tr>
</thead>
<tbody>
<tr>
<td>App Roles</td>
<td>Yes (for advanced scenarios)</td>
<td>Bulk creation, localized display names, assigning to apps</td>
<td><a href="https://learn.microsoft.com/en-us/entra/identity-platform/reference-app-manifest" rel="noopener" target="_blank">Define app roles</a></td>
</tr>
<tr>
<td>OAuth2 Scopes</td>
<td>Yes (for advanced scenarios)</td>
<td>Bulk scope definitions, localized descriptions</td>
<td><a href="https://learn.microsoft.com/en-us/entra/identity-platform/reference-app-manifest" rel="noopener" target="_blank">Define scopes and permissions</a></td>
</tr>
<tr>
<td>Custom Claims</td>
<td>Yes</td>
<td>Emit custom attributes, add app display name, configure group claims</td>
<td><a href="https://learn.microsoft.com/en-us/entra/identity-platform/reference-app-manifest" rel="noopener" target="_blank">Token configuration and optional claims</a></td>
</tr>
<tr>
<td>Role Assignments</td>
<td>No</td>
<td>Assign users/groups or apps to roles</td>
<td><a href="https://learn.microsoft.com/en-us/entra/identity-platform/howto-add-app-roles-in-apps#assign-app-roles-to-applications" rel="noopener" target="_blank">Assign app roles</a>
    <a href="https://www.youtube.com/watch?v=HdBSBSbgYQQ" rel="noopener" target="_blank">App roles for users (youtube talk)</a>
</td>

</tr>
<tr>
<td>Security Groups</td>
<td>No</td>
<td>Create groups, assign users, use for role assignment</td>
<td><a href="https://learn.microsoft.com/en-us/entra/identity-platform/howto-add-app-roles-in-apps#assign-users-and-groups-to-microsoft-entra-roles" rel="noopener" target="_blank">Manage groups in Entra ID</a></td>
</tr>
</tbody>
</table>
</section>

<section id="rbac-elements">
<h2>RBAC Elements in Microsoft Entra ID</h2>
<p>This section summarizes key elements used in Role-Based Access Control (RBAC) within Microsoft Entra ID, including Role, Scope, Permission, User Groups, and Security Groups. These elements work together to define how access is granted and enforced in applications and APIs.</p>
<table border="1" cellpadding="6" cellspacing="0" id="rbac-elements-table">
<thead>
<tr><th>Element</th><th>What it is</th><th>Use case</th><th>Token behavior</th><th>Configuration link</th></tr>
</thead>
<tbody><tr><td>Role</td><td>A named permission set defined in an app registration (App Roles) or a built-in directory role (like Global Admin).</td><td>Application roles: control what a user or app can do in a specific API. Directory roles: control what a user can do in Entra ID itself.</td><td>Appears in the <code>roles</code> claim when assigned.</td><td><a href="https://learn.microsoft.com/en-us/entra/identity-platform/howto-add-app-roles-in-apps" rel="noopener" target="_blank">Configure</a></td></tr><tr><td>Scope</td><td>A string representing a delegated permission defined by an API (e.g., <code>Items.Read</code>).</td><td>Fine-grained access control for delegated (user) calls to your API; requested by client apps.</td><td>Appears in the <code>scp</code> claim in access tokens.</td><td><a href="https://learn.microsoft.com/en-us/entra/identity-platform/quickstart-configure-app-expose-web-apis" rel="noopener" target="_blank">Configure</a></td></tr><tr><td>Permission</td><td><p><strong>Delegated:</strong> Scope granted to an app acting on behalf of a user.</p><p><strong>Application:</strong> App role granted to an app acting as itself (daemon).</p></td><td><p><strong>Delegated:</strong> Web/mobile apps calling APIs for a signed-in user.</p><p><strong>Application:</strong> Daemon apps or background services.</p></td><td><p><strong>Delegated:</strong> Appears in <code>scp</code> claim.</p><p><strong>Application:</strong> Appears in <code>roles</code> claim.</p></td><td><a href="https://learn.microsoft.com/en-us/entra/identity-platform/v2-permissions-and-consent" rel="noopener" target="_blank">Configure</a></td></tr><tr><td>User Groups</td><td>A collection of users (and optionally devices) in Entra ID.</td><td>Assign app roles or CA policies to many users at once; drive group-based role assignments to apps.</td><td>If group claims are configured, token can include <code>groups</code> (IDs). If the group is assigned to an app role, user inherits that role → <code>roles</code>.</td><td><a href="https://learn.microsoft.com/en-us/security/zero-trust/develop/configure-tokens-group-claims-app-roles" rel="noopener" target="_blank">Configure</a></td></tr><tr><td>Security Groups</td><td>A type of group used for access control (as opposed to M365 groups for collaboration).</td><td>Assign application roles to security groups for RBAC; use in CA or resource access.</td><td>Can appear in <code>groups</code> (if configured). If assigned to an app role, results in user’s <code>roles</code> claim containing that role.</td><td><a href="https://learn.microsoft.com/en-us/entra/identity/users/groups-create-azure-portal" rel="noopener" target="_blank">Configure</a></td></tr></tbody>
</table>
<p>Diagram placeholder: User → Group → Role → Token claims (`roles`, `scp`, `groups`).</p><p>Sources: Microsoft Learn - App roles, scopes, permissions, and group claims configuration.</p></section>
<section class="card" id="matrix">
<h2>Token expectations per flow</h2>
<table>
<thead>
<tr>
<th>Flow</th>
<th>Subject</th>
<th>Access token carries</th>
<th>Where to define roles</th>
<th>Your API should enforce</th>
<th>Configuration Link</th></tr>
</thead>
<tbody>
<tr>
<td>Authorization Code (incl. PKCE)</td>
<td>User</td>
<td><span class="pill">scp</span>; <span class="pill">roles</span> if user-to-API role assigned</td>
<td>API app → App roles (Users/Groups)</td>
<td>Required scopes; optionally roles</td>
<td><a href="#" target="_blank">Configure</a></td></tr>
<tr>
<td>Device Code</td>
<td>User</td>
<td><span class="pill">scp</span>; <span class="pill">roles</span> if user-to-API role assigned</td>
<td>API app → App roles (Users/Groups)</td>
<td>Required scopes; optionally roles</td>
<td><a href="#" target="_blank">Configure</a></td></tr>
<tr>
<td>On-Behalf-Of (OBO)</td>
<td>User</td>
<td><span class="pill">scp</span>; <span class="pill">roles</span> if user-to-API role assigned</td>
<td>Downstream API app → App roles (Users/Groups)</td>
<td>Required scopes (and roles if used)</td>
<td><a href="#" target="_blank">Configure</a></td></tr>
<tr>
<td>Client Credentials</td>
<td>Application</td>
<td><span class="pill">roles</span> only (no <code>scp</code>)</td>
<td>API app → App roles (Applications)</td>
<td>Required application roles</td>
<td><a href="#" target="_blank">Configure</a></td></tr>
</tbody>
</table>
<div class="sources">
<h4>Sources for this section</h4>
<ul>
<li><a href="https://learn.microsoft.com/en-us/entra/identity-platform/scenario-protected-web-api-verification-scope-app-roles" rel="noopener" target="_blank">Verify scopes &amp; app roles</a></li>
<li><a href="https://learn.microsoft.com/en-us/answers/questions/2237097/azure-ad-access-token-is-missing-scope-or-roles-cl" rel="noopener" target="_blank">Client credentials: no scp claim</a></li>
<li><a href="https://docs.azure.cn/en-us/entra/identity-platform/access-token-claims-reference" rel="noopener" target="_blank">Access token claims reference</a></li>
</ul>
</div>
</section>
<section class="card" id="key-insight">
<h2>Key Insight: Delegated flows differ in how the client obtains a token, not in how Entra ID populates claims</h2>
<p>For <strong>Authorization Code</strong>, <strong>Device Code</strong>, and <strong>On‑Behalf‑Of</strong> flows, the client obtains the user-delegated token via different mechanisms (interactive, device-assisted, or middle-tier exchange). However, once Microsoft Entra ID issues an <em>access token for your API</em>, the <strong>claim semantics are the same</strong>:</p>
<ul>
<li><code>scp</code> lists the <em>delegated scopes</em> granted to the client on behalf of the user.</li>
<li><code>roles</code> appears if the user has <em>app roles</em> defined on the API and assigned (direct or via group).</li>
<li>This behavior is consistent across the three delegated flows; the difference is <em>only</em> how the token is acquired.</li>
</ul>
<h3>Diagram: Different acquisition paths → Same claims in the API token</h3>
<svg aria-label="Diagram showing three delegated flows feeding a common access token and claims evaluation" role="img" viewbox="0 0 980 360" width="100%">
<defs>
<style>
        .box{fill:#0b1220;stroke:#1f2937;stroke-width:1.2}
        .label{fill:#e5e7eb;font: 12px/1.2 ui-monospace, SFMono-Regular, Consolas}
        .title{fill:#cfe1ff;font: 13.5px/1.2 system-ui,Segoe UI,Roboto}
        .arrow{stroke:#60a5fa;stroke-width:2;marker-end:url(#arrow)}
      </style>
<marker id="arrow" markerheight="7" markerwidth="10" orient="auto" refx="10" refy="3.5">
<polygon fill="#60a5fa" points="0 0, 10 3.5, 0 7"></polygon>
</marker>
</defs>
<!-- Column boxes: Auth Code, Device Code, OBO -->
<rect class="box" height="80" rx="10" width="270" x="20" y="30"></rect>
<text class="title" x="35" y="55">Authorization Code (interactive)</text>
<text class="label" x="35" y="75">User signs in in browser</text>
<text class="label" x="35" y="92">Client gets code → exchanges for token</text>
<rect class="box" height="80" rx="10" width="270" x="350" y="30"></rect>
<text class="title" x="365" y="55">Device Code</text>
<text class="label" x="365" y="75">User enters device code on another device</text>
<text class="label" x="365" y="92">Client polls → gets token</text>
<rect class="box" height="80" rx="10" width="270" x="680" y="30"></rect>
<text class="title" x="695" y="55">On‑Behalf‑Of (OBO)</text>
<text class="label" x="695" y="75">Middle tier trades user token</text>
<text class="label" x="695" y="92">for downstream API token</text>
<!-- Common access token box -->
<rect class="box" height="80" rx="10" width="620" x="180" y="150"></rect>
<text class="title" x="195" y="175">Access token for API (delegated)</text>
<text class="label" x="195" y="195">Claims: scp = delegated scopes; roles = user app roles (if assigned)</text>
<!-- API evaluation box -->
<rect class="box" height="70" rx="10" width="420" x="280" y="260"></rect>
<text class="title" x="295" y="285">API evaluates claims</text>
<text class="label" x="295" y="305">Delegated: check <scp> via RequiredScope; optionally check roles</scp></text>
<!-- Arrows from sources to token -->
<line class="arrow" x1="290" x2="300" y1="110" y2="150"></line>
<line class="arrow" x1="485" x2="490" y1="110" y2="150"></line>
<line class="arrow" x1="840" x2="780" y1="110" y2="150"></line>
<!-- Arrow from token to evaluation -->
<line class="arrow" x1="490" x2="490" y1="230" y2="260"></line>
</svg>
<div class="sources">
<h4>Sources for this section</h4>
<ul>
<li><a href="https://learn.microsoft.com/en-us/entra/identity-platform/scenario-protected-web-api-verification-scope-app-roles" rel="noopener" target="_blank">Protected web API: Verify scopes &amp; app roles</a></li>
<li><a href="https://learn.microsoft.com/en-us/entra/identity-platform/scenario-protected-web-api-app-configuration" rel="noopener" target="_blank">Protected web API: Code configuration</a></li>
<li><a href="https://learn.microsoft.com/en-us/entra/identity-platform/v2-permissions-and-consent" rel="noopener" target="_blank">Permissions &amp; consent (scopes/delegated)</a></li>
</ul>
</div>
</section>
<section class="card" id="checklist">
<h2>Entra ID configuration checklist</h2>
<ol>
<li><strong>Create / open</strong> your <em>API</em> app registration → <strong>App roles</strong> → <em>Create app role</em> for Users/Groups and/or Applications.</li>
<li><strong>Assign roles</strong> in <em>Enterprise applications → [Your API] → Users and groups</em> (for users) or to the calling <em>application’s service principal</em> (for app-only).</li>
<li><strong>Client (caller) requests</strong> tokens for your API: 
          <code class="inline">api://&lt;API-CLIENT-ID&gt;/&lt;scope&gt;</code> (delegated) or 
          <code class="inline">api://&lt;API-CLIENT-ID&gt;/.default</code> (app-only).</li>
<li><strong>Avoid</strong> emitting groups <em>as roles</em> when you rely on app roles (it hides app roles from the <code class="inline">roles</code> claim).</li>
</ol>
<div class="sources">
<h4>Sources for this section</h4>
<ul>
<li><a href="https://learn.microsoft.com/en-us/entra/identity-platform/howto-add-app-roles-in-apps" rel="noopener" target="_blank">Add app roles &amp; receive them in the token</a></li>
<li><a href="https://learn.microsoft.com/en-us/entra/identity-platform/scenario-protected-web-api-verification-scope-app-roles" rel="noopener" target="_blank">Verify scopes &amp; app roles</a></li>
<li><a href="https://learn.microsoft.com/en-us/security/zero-trust/develop/configure-tokens-group-claims-app-roles" rel="noopener" target="_blank">Configure group claims &amp; app roles (emit_as_roles behavior)</a></li>
</ul>
</div>
</section>
<section class="grid grid-2" id="examples">
<div class="card">
<h2>Example: API app manifest (app roles)</h2>
<p>Defines one user role and one application role. Assign users/groups to the former, and assign calling apps to the latter.</p>
<pre><code>{
  "appRoles": [
    {
      "allowedMemberTypes": [ "User" ],
      "description": "End users allowed to read data.",
      "displayName": "Reader",
      "id": "11111111-1111-1111-1111-111111111111",
      "isEnabled": true,
      "value": "Reader"
    },
    {
      "allowedMemberTypes": [ "Application" ],
      "description": "Daemon apps allowed to ingest data.",
      "displayName": "Ingestor",
      "id": "22222222-2222-2222-2222-222222222222",
      "isEnabled": true,
      "value": "Ingestor"
    }
  ]
}
</code></pre>
<div class="sources">
<h4>Sources for this section</h4>
<ul>
<li><a href="https://learn.microsoft.com/en-us/entra/identity-platform/howto-add-app-roles-in-apps" rel="noopener" target="_blank">Add app roles (manifest &amp; UI)</a></li>
</ul>
</div>
</div>
<div class="card">
<h2>Example: Expose an API (scopes)</h2>
<p>For delegated access, define scopes under <em>Expose an API</em> and require them in your API.</p>
<pre><code>{
  "oauth2Permissions": [
    {
      "adminConsentDescription": "Allow the app to read items as the signed-in user.",
      "adminConsentDisplayName": "Read items",
      "id": "33333333-3333-3333-3333-333333333333",
      "isEnabled": true,
      "type": "User",
      "userConsentDescription": "Read items you have access to.",
      "userConsentDisplayName": "Read items",
      "value": "Items.Read"
    }
  ]
}
</code></pre>
<div class="sources">
<h4>Sources for this section</h4>
<ul>
<li><a href="https://learn.microsoft.com/en-us/entra/identity-platform/scenario-protected-web-api-verification-scope-app-roles" rel="noopener" target="_blank">Verify scopes &amp; app roles</a></li>
</ul>
</div>
</div>
</section>
<section class="card" id="aspnet-core">
<h2>ASP.NET Core authorization snippets</h2>
<h3>1) Configure authentication for a protected API</h3>
<pre><code>// Program.cs (.NET 8 minimal sample)
using Microsoft.AspNetCore.Authentication.JwtBearer;
using Microsoft.Identity.Web;

var builder = WebApplication.CreateBuilder(args);

builder.Services
    .AddAuthentication(JwtBearerDefaults.AuthenticationScheme)
    .AddMicrosoftIdentityWebApi(builder.Configuration.GetSection("AzureAd"));

// Optional: ensure role claim type is mapped correctly (v2 tokens use "roles")
builder.Services.Configure<jwtbeareroptions>(JwtBearerDefaults.AuthenticationScheme, options =&gt;
{
    options.TokenValidationParameters.RoleClaimType = "roles"; // explicit
});

builder.Services.AddAuthorization();

var app = builder.Build();
app.UseAuthentication();
app.UseAuthorization();

app.MapControllers();
app.Run();
</jwtbeareroptions></code></pre>
<h3>2) Delegated calls (user): enforce scopes and optionally roles</h3>
<pre><code>using Microsoft.AspNetCore.Authorization;
using Microsoft.Identity.Web;

[Authorize]
[RequiredScope("Items.Read")] // Enforce scope from Expose an API
[ApiController]
[Route("api/[controller]")]
public class ItemsController : ControllerBase
{
    [HttpGet]
    public IActionResult Get() =&gt; Ok(new [] { "a", "b" });

    // If you also use user app roles on the API, you can require them:
    [HttpGet("/admin")]
    [Authorize(Roles = "Reader")] // roles claim must include "Reader"
    public IActionResult AdminOnly() =&gt; Ok("ok");
}
</code></pre>
<h3>3) App-only (daemon) calls: enforce application roles</h3>
<pre><code>using Microsoft.AspNetCore.Authorization;

[ApiController]
[Route("api/[controller]")]
public class IngestController : ControllerBase
{
    // Client credentials tokens won't have an "scp" claim; require an application role instead
    [HttpPost]
    [Authorize(Roles = "Ingestor")] // roles claim must include "Ingestor"
    public IActionResult Post([FromBody] object payload) =&gt; Ok();
}
</code></pre>
<div class="sources">
<h4>Sources for this section</h4>
<ul>
<li><a href="https://learn.microsoft.com/en-us/entra/identity-platform/scenario-protected-web-api-app-configuration" rel="noopener" target="_blank">Protected web API: Code configuration</a></li>
<li><a href="https://learn.microsoft.com/en-us/entra/identity-platform/scenario-protected-web-api-verification-scope-app-roles" rel="noopener" target="_blank">Verify scopes &amp; app roles</a></li>
<li><a href="https://learn.microsoft.com/en-us/answers/questions/2237097/azure-ad-access-token-is-missing-scope-or-roles-cl" rel="noopener" target="_blank">Client credentials: roles only, no scp</a></li>
</ul>
</div>
</section>
<section class="card" id="testing">
<h2>Testing tips</h2>
<ul>
<li><strong>User flow:</strong> Acquire token for <code class="inline">api://&lt;API-ID&gt;/Items.Read</code>; access token will carry <code class="inline">scp</code> (and <code class="inline">roles</code> if applicable).</li>
<li><strong>App-only flow:</strong> Acquire token with scope <code class="inline">api://&lt;API-ID&gt;/.default</code>; verify access token has <code class="inline">roles</code> and omits <code class="inline">scp</code>.</li>
</ul>
<div class="sources">
<h4>Sources for this section</h4>
<ul>
<li><a href="https://learn.microsoft.com/en-us/entra/identity-platform/scenario-protected-web-api-verification-scope-app-roles" rel="noopener" target="_blank">Verify scopes &amp; app roles</a></li>
<li><a href="https://learn.microsoft.com/en-us/answers/questions/2237097/azure-ad-access-token-is-missing-scope-or-roles-cl" rel="noopener" target="_blank">Client credentials token behavior</a></li>
</ul>
</div>
</section>
<section class="card" id="troubleshooting">
<h2>Troubleshooting</h2>
<ul>
<li><strong>No roles in access token (delegated):</strong> Ensure roles are defined on the <em>API</em> app and the user is assigned to them; or rely on scopes only.</li>
<li><strong>No roles in app-only token:</strong> Confirm the API exposes <em>application</em> roles and the calling app’s service principal is assigned in Enterprise apps.</li>
<li><strong>Groups emitted as roles hides app roles:</strong> Disable <em>emit_as_roles</em> for groups if you need app roles in the <code class="inline">roles</code> claim.</li>
</ul>
<div class="sources">
<h4>Sources for this section</h4>
<ul>
<li><a href="https://learn.microsoft.com/en-us/entra/identity-platform/howto-add-app-roles-in-apps" rel="noopener" target="_blank">Add app roles</a></li>
<li><a href="https://learn.microsoft.com/en-us/security/zero-trust/develop/configure-tokens-group-claims-app-roles" rel="noopener" target="_blank">Group claims &amp; app roles interactions</a></li>
</ul>
</div>
</section>
<section class="card footnotes" id="all-refs">
<h2>All references</h2>
<ol>
<li>Protected web API: <em>Verify scopes and app roles</em> — Microsoft Learn. <a href="https://learn.microsoft.com/en-us/entra/identity-platform/scenario-protected-web-api-verification-scope-app-roles" rel="noopener" target="_blank">link</a></li>
<li>Client credentials tokens: <em>scp absent; use app roles</em> — Microsoft Q&amp;A. <a href="https://learn.microsoft.com/en-us/answers/questions/2237097/azure-ad-access-token-is-missing-scope-or-roles-cl" rel="noopener" target="_blank">link</a></li>
<li>Add app roles to your application and receive them in the token — Microsoft Learn. <a href="https://learn.microsoft.com/en-us/entra/identity-platform/howto-add-app-roles-in-apps" rel="noopener" target="_blank">link</a></li>
<li>ID token claims reference — Microsoft Learn. <a href="https://learn.microsoft.com/en-us/entra/identity-platform/id-token-claims-reference" rel="noopener" target="_blank">link</a></li>
<li>Configure group claims and app roles in tokens — Microsoft Learn. <a href="https://learn.microsoft.com/en-us/security/zero-trust/develop/configure-tokens-group-claims-app-roles" rel="noopener" target="_blank">link</a></li>
<li>Protected web API: Code configuration — Microsoft Learn. <a href="https://learn.microsoft.com/en-us/entra/identity-platform/scenario-protected-web-api-app-configuration" rel="noopener" target="_blank">link</a></li>
<li>Access token claims reference — Microsoft Docs (CN mirror). <a href="https://docs.azure.cn/en-us/entra/identity-platform/access-token-claims-reference" rel="noopener" target="_blank">link</a></li>
</ol>
</section>
<footer class="muted" style="margin:16px 0 32px">© 2025 — One‑page cheat sheet with per‑section references.</footer>
</div>
</body>
</html>
